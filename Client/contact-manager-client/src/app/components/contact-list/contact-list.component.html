<div class="contact-list-container">
  <!-- Modern Header with Gradient Background -->
  <mat-toolbar class="header-toolbar">
    <mat-toolbar-row>
      <h1>Contact Manager</h1>
      <span class="spacer"></span>
      <div class="header-buttons">
        <button mat-raised-button class="add-contact-btn" (click)="navigateToAddContact()">
          <mat-icon>add</mat-icon>
          Add Contact
        </button>
        <button mat-stroked-button class="logout-btn" (click)="logout()">
          <mat-icon>logout</mat-icon>
          Logout
        </button>
      </div>
    </mat-toolbar-row>
  </mat-toolbar>

  <!-- Enhanced Search Field -->
  <div class="search-container">
    <mat-form-field class="search-field" appearance="outline">
      <mat-label>Search contacts...</mat-label>
      <input matInput 
             [(ngModel)]="searchTerm" 
             (input)="onSearch()" 
             placeholder="Search by name, phone, or address">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-container">
    <div class="stat-card">
      <span class="stat-number">{{ totalContacts }}</span>
      <span class="stat-label">Total Contacts</span>
    </div>
    <div class="stat-card">
      <span class="stat-number">{{ filteredContacts.length }}</span>
      <span class="stat-label">Filtered Results</span>
    </div>
    <div class="stat-card">
      <span class="stat-number">{{ currentPage + 1 }}</span>
      <span class="stat-label">Current Page</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="60"></mat-spinner>
    <div class="loading-text">Loading your contacts...</div>
  </div>

  <!-- Enhanced Contact Table -->
  <div *ngIf="!loading" class="table-container">
    <table mat-table [dataSource]="dataSource" class="contacts-table">
      
      <!-- Name Column with Avatar -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Contact</th>
        <td mat-cell *matCellDef="let contact" [class.editing-row]="contact.isEditing" [class.locked-row]="contact.isLocked">
          <div class="contact-name">
            <div class="contact-avatar">
              {{ getInitials(contact.name) }}
            </div>
            <div *ngIf="!contact.isEditing">{{ contact.name }}</div>
            <mat-form-field *ngIf="contact.isEditing" class="edit-field" appearance="outline">
              <input matInput [(ngModel)]="contact.name" placeholder="Contact name">
            </mat-form-field>
            <div class="status-indicator" *ngIf="contact.isLocked && !contact.isEditing">
              <mat-icon class="locked-icon">lock</mat-icon>
              <small>Locked by another user</small>
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Phone Column -->
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef>Phone</th>
        <td mat-cell *matCellDef="let contact">
          <div *ngIf="!contact.isEditing" class="contact-phone">{{ contact.phone }}</div>
          <mat-form-field *ngIf="contact.isEditing" class="edit-field" appearance="outline">
            <input matInput [(ngModel)]="contact.phone" placeholder="Phone number">
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Address Column -->
      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef>Address</th>
        <td mat-cell *matCellDef="let contact">
          <div *ngIf="!contact.isEditing" class="contact-address" [title]="contact.address">
            {{ contact.address }}
          </div>
          <mat-form-field *ngIf="contact.isEditing" class="edit-field" appearance="outline">
            <input matInput [(ngModel)]="contact.address" placeholder="Address">
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Notes Column -->
      <ng-container matColumnDef="notes">
        <th mat-header-cell *matHeaderCellDef>Notes</th>
        <td mat-cell *matCellDef="let contact">
          <div *ngIf="!contact.isEditing" class="contact-notes" [title]="contact.notes">
            {{ contact.notes || 'No notes' }}
          </div>
          <mat-form-field *ngIf="contact.isEditing" class="edit-field" appearance="outline">
            <textarea matInput [(ngModel)]="contact.notes" placeholder="Notes" rows="2"></textarea>
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Enhanced Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let contact">
          <div class="action-buttons">
            <!-- Edit/Save/Cancel buttons -->
            <button *ngIf="!contact.isEditing && !contact.isLocked" 
                    mat-icon-button 
                    color="primary"
                    (click)="startEditing(contact)"
                    matTooltip="Edit contact">
              <mat-icon>edit</mat-icon>
            </button>
            
            <button *ngIf="contact.isEditing" 
                    mat-icon-button 
                    color="accent"
                    (click)="saveEdit(contact)"
                    matTooltip="Save changes">
              <mat-icon>save</mat-icon>
            </button>
            
            <button *ngIf="contact.isEditing" 
                    mat-icon-button 
                    (click)="cancelEdit(contact)"
                    matTooltip="Cancel editing">
              <mat-icon>cancel</mat-icon>
            </button>
            
            <!-- Delete button -->
            <button *ngIf="!contact.isEditing" 
                    mat-icon-button 
                    color="warn"
                    (click)="deleteContact(contact._id)"
                    matTooltip="Delete contact">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- Enhanced No Data State -->
    <div *ngIf="dataSource.data.length === 0" class="no-data">
      <div class="no-data-icon">ðŸ“ž</div>
      <h3>No Contacts Found</h3>
      <p>
        <span *ngIf="searchTerm">
          No contacts match your search criteria. Try adjusting your search terms.
        </span>
        <span *ngIf="!searchTerm">
          You haven't added any contacts yet. Start building your contact list by adding your first contact.
        </span>
      </p>
      <button mat-raised-button (click)="navigateToAddContact()">
        <mat-icon>add</mat-icon>
        Add Your First Contact
      </button>
    </div>
  </div>

  <!-- Enhanced Paginator -->
  <mat-paginator 
    *ngIf="!loading && dataSource.data.length > 0"
    [length]="totalContacts"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 20]"
    [pageIndex]="currentPage"
    (page)="onPageChange($event)"
    showFirstLastButtons>
  </mat-paginator>
</div>
